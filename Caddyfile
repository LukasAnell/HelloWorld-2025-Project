resumereviewer.lukasanell.org {
    encode zstd gzip
    reverse_proxy /analyze* http://backend:8000 {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Host {host}
    }
    reverse_proxy /health* http://backend:8000
    # Optional: expose Ollama locally for debugging on internal network only
    # route /ollama/* {
    #     reverse_proxy http://ollama:11434
    # }

    # Serve static assets (Caddy will look in site)
    root * /srv/static
    file_server

    # Security headers
    header {
        # Strict CSP for SPA (adjust to your actual asset hosts)
        Content-Security-Policy "default-src 'self'; script-src 'self'; connect-src 'self' https://resumereviewer.lukasanell.org; frame-ancestors 'none';"
        Referrer-Policy "no-referrer-when-downgrade"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
        Server ""  # attempt to hide server header
    }

    log {
        output file /var/log/caddy/resumereviewer.access.log {
            roll true
            roll_size_mb 50
            roll_local_time true
            roll_keep 5
        }
        format single_field common_log
    }
}
